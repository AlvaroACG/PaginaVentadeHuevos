<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hacer Pedido</title>
<link rel="stylesheet" href="style.css">
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>

<div id="navbar-container"></div>

<section class="form-card">
  <h2>Realizar Pedido ü•ö</h2>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <form action="https://formsubmit.co/acarvita@gmail.com" method="POST">
  
  <!-- ===== CONFIGURACI√ìN DEL CORREO ===== -->
    <input type="hidden" name="_subject" value="ü•ö NUEVO PEDIDO - HUEVOS FRESCOS ü•ö">
    <input type="hidden" name="_template" value="table">
    <input type="hidden" name="_captcha" value="false">
    <input type="hidden" name="_next" value="https://tusitio.com/gracias.html">
    <input type="hidden" name="_autoresponse" value="‚úÖ ¬°Gracias por tu pedido! Te llamaremos para confirmar la entrega. Horario de atenci√≥n: Lunes a S√°bado 9:00-18:00 hrs.">
    
    <!-- ===== DATOS DEL CLIENTE ===== -->
    <h3>üìã INFORMACI√ìN DE CONTACTO</h3>
    <input type="text" name="üë§ NOMBRE COMPLETO" placeholder="Ej: Mar√≠a Gonz√°lez" required>
    <input type="tel" name="üì± TEL√âFONO / WHATSAPP" placeholder="Ej: +56 9 1234 5678" required>
    <input type="text" name="üìç DIRECCI√ìN DE ENTREGA" placeholder="Calle, n√∫mero, referencia" required>
    
    <!-- ===== PRODUCTOS ===== -->
    <h3>ü•ö PRODUCTOS SOLICITADOS</h3>
    
    <label>üì¶ Docenas ($2400)</label>
    <div style="display: flex; align-items: center; justify-content: flex-end;">
      <span style="font-weight: 500; margin-right: 10px;">Cantidad:</span>
      <div class="quantity-wrap">
        <button type="button" onclick="changeQty('docenas', -1)" class="qty-down">‚ñº</button>
        <input type="number" id="docenas" name="docenas" value="0" min="0" class="qty-field">
        <button type="button" onclick="changeQty('docenas', 1)" class="qty-up">‚ñ≤</button>
      </div>
    </div>
    
    <label>üì¶ Bandejas (30 huevos) ($6000)</label>
    <div style="display: flex; align-items: center; justify-content: flex-end;">
      <span style="font-weight: 500; margin-right: 10px;">Cantidad:</span>
      <div class="quantity-wrap">
        <button type="button" onclick="changeQty('bandejas', -1)" class="qty-down">‚ñº</button>
        <input type="number" id="bandejas" name="bandejas" value="0" min="0" class="qty-field">
        <button type="button" onclick="changeQty('bandejas', 1)" class="qty-up">‚ñ≤</button>
      </div>
    </div>
    <!-- ===== TOTAL (se env√≠a autom√°tico) ===== -->
    <h3>üí∞ TOTAL: $<span id="total">0</span></h3>
    <input type="hidden" name="üí∞ MONTO TOTAL" id="total-input">
    
    <!-- ===== FECHA Y HORA (autom√°tico) ===== -->
    <input type="hidden" name="üïê FECHA DEL PEDIDO" id="fecha-input">
    <input type="hidden" name="üåê P√ÅGINA" value="Formulario Web">
    
    <!-- Cloudflare Turnstile -->
    <div class="cf-turnstile" data-sitekey="0x4AAAAAACa7hVhkSs0CD7Cv"></div>
    
    <button type="submit" class="btn-primary">‚úÖ CONFIRMAR PEDIDO</button>
  </form>

<script>
document.getElementById('pedidoForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  // ‚úÖ VALIDAR TURNSTILE - ESTO ES LO QUE FALTABA
  const turnstileResponse = document.querySelector('[name="cf-turnstile-response"]')?.value;
  
  if (!turnstileResponse) {
    alert('‚ùå Por favor, completa el captcha');
    return;
  }
  
  // El resto de tu c√≥digo de env√≠o...
  // (validar productos, enviar, mostrar modal, etc)
  
});
</script>
<script>
// Calcular total
function changeQty(id, delta) {
  const input = document.getElementById(id);
  let val = parseInt(input.value) || 0;
  val = Math.max(0, val + delta);
  input.value = val;
  calcularTotal();
}

function calcularTotal() {
  const doc = parseInt(document.getElementById('docenas').value) || 0;
  const ban = parseInt(document.getElementById('bandejas').value) || 0;
  const total = (doc * 2400) + (ban * 6000);
  document.getElementById('total').textContent = total;
  document.getElementById('total-input').value = '$' + total.toLocaleString('es-CL');
}

// Antes de enviar
document.querySelector('form').addEventListener('submit', function() {
  // Fecha actual
  const ahora = new Date();
  const fecha = ahora.toLocaleString('es-CL', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
  document.getElementById('fecha-input').value = fecha;
  
  // Total
  calcularTotal();
});

// Inicializar
calcularTotal();
</script>
</section>

<script>
function changeQty(id, amount) {
  const input = document.getElementById(id);
  let value = parseInt(input.value) || 0;
  value += amount;
  if (value < 0) value = 0;
  input.value = value;
  calcular();
}

function calcular() {
  const doc = parseInt(document.getElementById("docenas").value) || 0;
  const ban = parseInt(document.getElementById("bandejas").value) || 0;
  const total = (doc * 2400) + (ban * 6000);
  document.getElementById("total").textContent = total;
}

document.getElementById("docenas").addEventListener("input", calcular);
document.getElementById("bandejas").addEventListener("input", calcular);
</script>

<script>
fetch("navbar.html")
  .then(res => res.text())
  .then(data => {
    document.getElementById("navbar-container").innerHTML = data;
  });
</script>

</body>
</html>

